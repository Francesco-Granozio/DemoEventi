<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DemoEventi.UI.Views.InterestsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="{Binding Title}"
    BackgroundColor="{StaticResource BackgroundSecondary}">

    <Grid RowDefinitions="Auto,*,Auto">

        <!--  Header  -->
        <StackLayout
            Grid.Row="0"
            Padding="20,16,20,8">
            <Label
                Style="{StaticResource LargeTitleStyle}"
                Text="Interests"
                Margin="0,0,0,8" />
            <Button
                Style="{StaticResource SecondaryButtonStyle}"
                Command="{Binding RefreshCommand}"
                Text="â†» Refresh"
                HorizontalOptions="Start"
                WidthRequest="120" />
        </StackLayout>

        <!--  Error Message  -->
        <Frame
            Grid.Row="1"
            Style="{StaticResource CardStyle}"
            BackgroundColor="{StaticResource Danger}"
            IsVisible="{Binding HasError}"
            Margin="20,8">
            <Label
                Style="{StaticResource BodyStyle}"
                HorizontalOptions="Center"
                Text="{Binding ErrorMessage}"
                TextColor="{StaticResource White}" />
        </Frame>

        <!--  Loading Indicator  -->
        <StackLayout
            Grid.Row="1"
            IsVisible="{Binding IsBusy}"
            VerticalOptions="Center"
            HorizontalOptions="Center">
            <ActivityIndicator
                IsRunning="{Binding IsBusy}"
                Color="{StaticResource Primary}"
                WidthRequest="40"
                HeightRequest="40" />
            <Label
                Style="{StaticResource FootnoteStyle}"
                Text="Loading interests..."
                HorizontalOptions="Center"
                Margin="0,12,0,0" />
        </StackLayout>

        <!--  Interests List  -->
        <RefreshView
            Grid.Row="1"
            Command="{Binding RefreshCommand}"
            RefreshColor="{StaticResource Primary}"
            IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">
            <CollectionView 
                ItemsSource="{Binding Interests}"
                ItemSizingStrategy="MeasureAllItems"
                VerticalScrollBarVisibility="Never">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Style="{StaticResource CompactCardStyle}" Margin="20,5" Padding="15">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label
                                    Grid.Column="0"
                                    Style="{StaticResource HeadlineStyle}"
                                    VerticalOptions="Center"
                                    Text="{Binding Name}" />
                                <CheckBox
                                    Grid.Column="1"
                                    IsChecked="{Binding IsSelected}"
                                    Color="{StaticResource Primary}"
                                    VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <VerticalStackLayout 
                        HorizontalOptions="Center" 
                        VerticalOptions="Center"
                        Spacing="16"
                        Padding="40">
                        <Label
                            Style="{StaticResource Title2Style}"
                            Text="ðŸŒŸ"
                            HorizontalOptions="Center"
                            FontSize="48" />
                        <Label
                            Style="{StaticResource Title3Style}"
                            Text="No Interests Found"
                            HorizontalOptions="Center" />
                        <Label
                            Style="{StaticResource BodyStyle}"
                            Text="Pull down to refresh and discover new interests!"
                            TextColor="{StaticResource TextSecondary}"
                            HorizontalOptions="Center"
                            HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- Save Button -->
        <Button
            Grid.Row="2"
            Text="Save My Interests" 
            Command="{Binding SaveInterestsCommand}"
            Style="{StaticResource PrimaryButtonStyle}"
            Margin="20"
            IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}" />

    </Grid>

</ContentPage>
